// import path from "path";
// import { sequelize } from "../../../db/index.js";
// import Employee from "../models/employee.model.js";
// import Role from "../models/role.model.js";
// import BaseService from "../../../services/service.js";

// const employeeService = new BaseService(Employee);

// // ============================================================
// // ðŸ”¹ Create Employee
// // ============================================================
// export const createEmployee = async (req, res) => {
//   try {
//     const { username, email, phone, password, role_id } = req.body;

//     if (!username || !email || !phone || !password) {
//       return res.status(400).json({
//         message: "Username, email, phone, and password are required.",
//       });
//     }

//     // Check duplicate email
//     const existing = await Employee.findOne({ where: { email } });
//     if (existing) {
//       return res.status(400).json({ message: "Email already exists." });
//     }

//     const payload = {
//       username,
//       email,
//       phone,
//       password, // hash in middleware ideally
//       role_id: role_id || null,
//       // profile_picture: req.file
//       //   ? `/uploads/employees/${req.file.filename}`
//       //   : null,
//       profile_picture: req.file ? req.file.filename : null,

//       created_by: req.user?.id || "system",
//     };

//     const newEmployee = await employeeService.create(payload);

//     return res.status(201).json({
//       message: "Employee created successfully",
//       data: newEmployee,
//     });
//   } catch (error) {
//     console.error("âŒ Error creating employee:", error);
//     return res.status(500).json({
//       message: "Failed to create employee",
//       error: error.message,
//     });
//   }
// };

// // ============================================================
// // ðŸ”¹ Update Employee
// // ============================================================
// export const updateEmployee = async (req, res) => {
//   try {
//     const { id } = req.params;

//     const payload = {
//       ...req.body,
//       updated_by: req.user?.id || "system",
//     };

//     if (req.file) {
//       // payload.profile_picture = `/uploads/employees/${req.file.filename}`;
//       payload.profile_picture = req.file ? req.file.filename : null

//     }

//     const updatedEmployee = await employeeService.update(id, payload);

//     if (!updatedEmployee) {
//       return res.status(404).json({ message: "Employee not found" });
//     }

//     return res.status(200).json({
//       message: "Employee updated successfully",
//       data: updatedEmployee,
//     });
//   } catch (error) {
//     console.error("âŒ Error updating employee:", error);
//     return res.status(500).json({
//       message: "Failed to update employee",
//       error: error.message,
//     });
//   }
// };

// // ============================================================
// // ðŸ”¹ Get All Employees
// // ============================================================
// export const getAllEmployees = async (req, res) => {
//   try {
//     const { search = "", page = 1, limit = 10, orderBy = "createdAt", order = "ASC" } = req.query;
//     const offset = (page - 1) * limit;

//     const whereClause = search
//       ? {
//           [sequelize.Op.or]: [
//             { username: { [sequelize.Op.like]: `%${search}%` } },
//             { email: { [sequelize.Op.like]: `%${search}%` } },
//             { phone: { [sequelize.Op.like]: `%${search}%` } },
//           ],
//         }
//       : {};

//     const { rows, count } = await Employee.findAndCountAll({
//       where: whereClause,
//       include: [
//         {
//           model: Role,
//           as: "role",
//           attributes: ["id", "role_name"],
//         },
//       ],
//       order: [[orderBy, order]],
//       limit: parseInt(limit),
//       offset: parseInt(offset),
//     });

//     // âœ… Build full URL for profile pictures
//     const baseUrl = `${req.protocol}://${req.get("host")}`; // e.g., http://localhost:5000
//     const formattedRows = rows.map(emp => ({
//       ...emp.toJSON(),
//       profile_picture: emp.profile_picture
//         ? `${baseUrl}/uploads/employees/${emp.profile_picture}`
//         : null,
//     }));

//     return res.status(200).json({
//       message: "Employees fetched successfully",
//       data: formattedRows,
//       total: count,
//       page: parseInt(page),
//       totalPages: Math.ceil(count / limit),
//     });
//   } catch (error) {
//     console.error("âŒ Error fetching employees:", error);
//     return res.status(500).json({
//       message: "Failed to fetch employees",
//       error: error.message,
//     });
//   }
// };

// export const getEmployeeById = async (req, res) => {
//   try {
//     const { id } = req.params;
//     const employee = await Employee.findOne({
//       where: { id },
//       include: [
//         { model: Role, as: "role", attributes: ["id", "role_name"] },
//       ],
//     });

//     if (!employee)
//       return res.status(404).json({ message: "Employee not found" });

//     const baseUrl = `${req.protocol}://${req.get("host")}`;
//     const employeeData = {
//       ...employee.toJSON(),
//       profile_picture: employee.profile_picture
//         ? `${baseUrl}/uploads/employees/${employee.profile_picture}`
//         : null,
//     };

//     return res.status(200).json({
//       message: "Employee fetched successfully",
//       data: employeeData,
//     });
//   } catch (error) {
//     console.error("âŒ Error fetching employee:", error);
//     return res.status(500).json({
//       message: "Failed to fetch employee",
//       error: error.message,
//     });
//   }
// };

// // ============================================================
// // ðŸ”¹ Delete Employee
// // ============================================================
// export const deleteEmployee = async (req, res) => {
//   try {
//     const { id } = req.params;

//     const result = await employeeService.delete(id);

//     if (!result) {
//       return res.status(404).json({ message: "Employee not found" });
//     }

//     return res.status(200).json({
//       message: "Employee deleted successfully",
//     });
//   } catch (error) {
//     console.error("âŒ Error deleting employee:", error);
//     return res.status(500).json({
//       message: "Failed to delete employee",
//       error: error.message,
//     });
//   }
// };


//  // âœ… Login Employee
//  export const emplogin =  async (req, res) => {
//     try {
//       const { username, password } = req.body;

//       const employee = await Employee.findOne({ where: { username } });
//       if (!employee) {
//         return res.status(404).json({ message: "Employee not found" });
//       }

//       const isMatch = await bcrypt.compare(password, employee.password);
//       if (!isMatch) {
//         return res.status(401).json({ message: "Invalid password" });
//       }

//       // Generate JWT token
//       const token = jwt.sign(
//         {
//           id: employee.id,
//           username: employee.username,
//           role: employee.role,
//         },
//         JWT_SECRET,
//         { expiresIn: "1d" }
//       );

//       res.status(200).json({
//         message: "Login successful",
//         token,
//         user: {
//           id: employee.id,
//           username: employee.username,
//           email: employee.email,
//           role: employee.role,
//         },
//       });
//     } catch (error) {
//       res.status(500).json({ message: error.message });
//     }
//   }

//   // âœ… Get Profile
//   export const getEmpProfile =  async (req, res) => {
//     try {
//       const employee = await Employee.findByPk(req.user.id, {
//         attributes: ["id", "username", "email", "phone", "role"],
//       });
//       res.status(200).json({ data: employee });
//     } catch (error) {
//       res.status(500).json({ message: error.message });
//     }
//   }


